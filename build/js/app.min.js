var game={data:{score:0},onload:function(){me.video.init(2500,2253,{parent:"screen",scale:"auto",scaleMethod:"flex-width"})?(me.audio.init("mp3,ogg"),me.loader.onload=this.loaded.bind(this),me.loader.preload(game.resources),me.state.change(me.state.LOADING)):alert("Your browser does not support HTML5 canvas.")},loaded:function(){me.state.set(me.state.MENU,new game.TitleScreen),me.state.set(me.state.PLAY,new game.PlayScreen),me.pool.register("mainPlayer",game.PlayerEntity),me.pool.register("granny",game.Granny),me.pool.register("CoatEntity",game.CoatEntity),me.pool.register("EnemyEntity",game.EnemyEntity),me.input.bindKey(me.input.KEY.LEFT,"left"),me.input.bindKey(me.input.KEY.RIGHT,"right"),me.input.bindKey(me.input.KEY.UP,"up"),me.input.bindKey(me.input.KEY.DOWN,"down"),me.state.change(me.state.MENU)},resources:[{name:"dst-inertexponent",type:"audio",src:"data/bgm/"},{name:"cling",type:"audio",src:"data/sfx/"},{name:"jump",type:"audio",src:"data/sfx/"},{name:"sprite",type:"audio",src:"data/sfx/"},{name:"gripe_run_right",type:"audio",src:"data/sfx/sprite/"},{name:"spinning_coin_gold",type:"audio",src:"data/sfx/sprite/"},{name:"wheelie_right",type:"audio",src:"data/sfx/sprite/"},{name:"stomp",type:"audio",src:"data/sfx/"},{name:"babulya_coat_slippers",type:"image",src:"data/img/babulya_coat_slippers.png"},{name:"babulya_glasses",type:"image",src:"data/img/babulya_glasses.png"},{name:"babulya",type:"image",src:"data/img/babulya.png"},{name:"babulya1",type:"image",src:"data/img/babulya1.png"},{name:"babulyaCoat",type:"image",src:"data/img/babulyaCoat.png"},{name:"background",type:"image",src:"data/img/background.png"},{name:"clouds",type:"image",src:"data/img/clouds.png"},{name:"coat",type:"image",src:"data/img/coat.png"},{name:"interior",type:"image",src:"data/img/interior.png"},{name:"area01_level_tiles",type:"image",src:"data/img/map/area01_level_tiles.png"},{name:"policeman",type:"image",src:"data/img/policeman.png"},{name:"gripe_run_right",type:"image",src:"data/img/sprite/gripe_run_right.png"},{name:"spinning_coin_gold",type:"image",src:"data/img/sprite/spinning_coin_gold.png"},{name:"wheelie_right",type:"image",src:"data/img/sprite/wheelie_right.png"},{name:"television_test",type:"image",src:"data/img/television_test.png"},{name:"television",type:"image",src:"data/img/television.png"},{name:"vector_babulya",type:"image",src:"data/img/vector_babulya.png"},{name:"area01",type:"tmx",src:"data/map/area01.tmx"},{name:"area02",type:"tmx",src:"data/map/area02.tmx"},{name:"area04",type:"tmx",src:"data/map/area04.tmx"},{name:"area05",type:"tmx",src:"data/map/area05.tmx"},{name:"tv_maze",type:"tmx",src:"data/map/tv_maze.tmx"}]};game.PlayerEntity=me.Entity.extend({init:function(e,t,a){me.Entity.prototype.init.apply(this,[e,t,a]),this.body.setVelocity(4,5),me.game.viewport.follow(this.pos,me.game.viewport.AXIS.BOTH,.4),this.alwaysUpdate=!0,this.renderable.addAnimation("walk",[0]),this.renderable.addAnimation("stand",[0]),this.renderable.setCurrentAnimation("stand"),this.body.ignoreGravity=!0},update:function(e){return me.input.isKeyPressed("left")?(this.renderable.flipX(!0),this.body.vel.x-=this.body.accel.x,this.renderable.isCurrentAnimation("walk")||this.renderable.setCurrentAnimation("walk")):me.input.isKeyPressed("right")?(this.renderable.flipX(!1),this.body.vel.x+=this.body.accel.x,this.renderable.isCurrentAnimation("walk")||this.renderable.setCurrentAnimation("walk")):me.input.isKeyPressed("up")?this.body.vel.y=-this.body.maxVel.y:me.input.isKeyPressed("down")?this.body.vel.y=+this.body.maxVel.y:(this.body.vel.x=0,this.body.vel.y=0,this.renderable.setCurrentAnimation("stand")),this.body.update(e),me.collision.check(this),me.Entity.prototype.update.apply(this,[e])||0!==this.body.vel.x||0!==this.body.vel.y},onCollision:function(e,t){switch(e.b.body.collisionType){case me.collision.types.WORLD_SHAPE:if("platform"===t.type)return!!(this.body.falling&&!me.input.isKeyPressed("down")&&0<e.overlapV.y&&~~this.body.vel.y>=~~e.overlapV.y)&&!(e.overlapV.x=0);break;case me.collision.types.ENEMY_OBJECT:return 0<e.overlapV.y&&this.body.falling?(this.body.vel.y=-this.body.maxVel.y,me.audio.play("stomp")):this.renderable.flicker(750),!1;default:return!1}return!0}}),game.Granny=me.Entity.extend({init:function(e,t,a){me.Entity.prototype.init.apply(this,[e,t,a]),this.body.setVelocity(4,5),me.game.viewport.follow(this.pos,me.game.viewport.AXIS.BOTH,.4),this.alwaysUpdate=!0,this.renderable.addAnimation("walk",[2,3]),this.renderable.addAnimation("stand",[2]),this.renderable.setCurrentAnimation("stand")},update:function(e){return me.input.isKeyPressed("left")?(this.renderable.flipX(!0),this.body.vel.x-=this.body.accel.x,this.renderable.isCurrentAnimation("walk")||this.renderable.setCurrentAnimation("walk")):me.input.isKeyPressed("right")?(this.renderable.flipX(!1),this.body.vel.x+=this.body.accel.x,this.renderable.isCurrentAnimation("walk")||this.renderable.setCurrentAnimation("walk")):(this.body.vel.x=0,this.renderable.setCurrentAnimation("stand")),this.body.update(e),me.collision.check(this),me.Entity.prototype.update.apply(this,[e])||0!==this.body.vel.x||0!==this.body.vel.y},onCollision:function(e,t){switch(e.b.body.collisionType){case me.collision.types.WORLD_SHAPE:if("platform"===t.type)return!!(this.body.falling&&!me.input.isKeyPressed("down")&&0<e.overlapV.y&&~~this.body.vel.y>=~~e.overlapV.y)&&!(e.overlapV.x=0);break;case me.collision.types.ENEMY_OBJECT:return 0<e.overlapV.y&&this.body.falling?(this.body.vel.y=-this.body.maxVel.y,me.audio.play("stomp")):this.renderable.flicker(750),!1;default:return!1}return!0}}),game.CoatEntity=me.CollectableEntity.extend({init:function(e,t,a){me.CollectableEntity.prototype.init.apply(this,[e,t,a])},onCollision:function(e,t){return me.audio.play("cling"),game.data.score+=250,this.body.setCollisionMask(me.collision.types.NO_OBJECT),me.game.world.removeChild(this),!1}}),game.EnemyEntity=me.Entity.extend({init:function(e,t,a){a.image="policeman";var i=a.width;a.height;a.framewidth=a.width=670,a.frameheight=a.height=1087,a.shapes[0]=new me.Rect(0,0,a.framewidth,a.frameheight),me.Entity.prototype.init.apply(this,[e,t,a]),e=this.pos.x,this.startX=e,this.endX=e+i-a.framewidth,this.pos.x=e+i-a.framewidth,this.walkLeft=!1,this.body.setVelocity(4,6)},update:function(e){},onCollision:function(e,t){return e.b.body.collisionType===me.collision.types.WORLD_SHAPE||(this.alive&&0<e.overlapV.y&&e.a.body.falling&&this.renderable.flicker(750),!1)}}),game.HUD=game.HUD||{},game.HUD.Container=me.Container.extend({init:function(){me.Container.prototype.init.apply(this),this.isPersistent=!0,this.floating=!0,this.name="HUD",this.addChild(new game.HUD.ScoreItem(-10,-10))}}),game.HUD.ScoreItem=me.Renderable.extend({init:function(e,t){me.Renderable.prototype.init.apply(this,[e,t,10,10]),this.font=new me.BitmapText(0,0,{font:"PressStart2P"}),this.font.textAlign="right",this.font.textBaseline="bottom",this.score=-1},update:function(){return this.score!==game.data.score&&(this.score=game.data.score,!0)},draw:function(e){this.font.draw(e,game.data.score,me.game.viewport.width+this.pos.x,me.game.viewport.height+this.pos.y)}}),game.resources=[{name:"gripe_run_right",type:"image",src:"data/img/sprite/gripe_run_right.png"},{name:"spinning_coin_gold",type:"image",src:"data/img/sprite/spinning_coin_gold.png"},{name:"wheelie_right",type:"image",src:"data/img/sprite/wheelie_right.png"},{name:"PressStart2P",type:"image",src:"data/fnt/PressStart2P.png"},{name:"PressStart2P",type:"binary",src:"data/fnt/PressStart2P.fnt"},{name:"title_screen",type:"image",src:"data/img/gui/title_screen.jpg"},{name:"background",type:"image",src:"data/img/background.png"},{name:"clouds",type:"image",src:"data/img/clouds.png"},{name:"area01_level_tiles",type:"image",src:"data/img/map/area01_level_tiles.png"},{name:"interior",type:"image",src:"data/img/interior.png"},{name:"coat",type:"image",src:"data/img/coat.png"},{name:"policeman",type:"image",src:"data/img/policeman.png"},{name:"babulya_glasses",type:"image",src:"data/img/babulya_glasses.png"},{name:"television",type:"image",src:"data/img/television.png"},{name:"vector_babulya",type:"image",src:"data/img/vector_babulya.png"},{name:"area01",type:"tmx",src:"data/map/area01.tmx"},{name:"tv_maze",type:"tmx",src:"data/map/tv_maze.tmx"},{name:"dst-inertexponent",type:"audio",src:"data/bgm/"},{name:"cling",type:"audio",src:"data/sfx/"},{name:"stomp",type:"audio",src:"data/sfx/"},{name:"jump",type:"audio",src:"data/sfx/"}],game.PlayScreen=me.Stage.extend({onResetEvent:function(){me.audio.playTrack("dst-inertexponent"),me.levelDirector.loadLevel("area01"),game.data.score=0,this.HUD=new game.HUD.Container,me.game.world.addChild(this.HUD)},onDestroyEvent:function(){me.game.world.removeChild(this.HUD)}}),game.TitleScreen=me.Stage.extend({onResetEvent:function(){var e=new me.Sprite(me.game.viewport.width/2,me.game.viewport.height/2,{image:me.loader.getImage("title_screen")});e.scale(me.game.viewport.width/e.width,me.game.viewport.height/e.height),me.game.world.addChild(e,1),me.game.world.addChild(new(me.Renderable.extend({init:function(){me.Renderable.prototype.init.apply(this,[0,0,me.game.viewport.width,me.game.viewport.height]),this.font=new me.BitmapText(0,0,{font:"PressStart2P"}),this.scroller="A SMALL STEP BY STEP TUTORIAL FOR GAME CREATION WITH MELONJS       ",this.scrollerpos=600,this.scrollertween=new me.Tween(this).to({scrollerpos:-2200},1e4).onComplete(this.scrollover.bind(this)).start()},scrollover:function(){this.scrollerpos=640,this.scrollertween.to({scrollerpos:-2200},1e4).onComplete(this.scrollover.bind(this)).start()},update:function(e){return!0},draw:function(e){this.font.textAlign="center",this.font.draw(e,"PRESS ENTER TO PLAY",me.game.viewport.width,540),this.font.textAlign="left",this.font.draw(e,this.scroller,this.scrollerpos,440)},onDestroyEvent:function(){this.scrollertween.stop()}})),2),me.input.bindKey(me.input.KEY.ENTER,"enter",!0),me.input.bindPointer(me.input.pointer.LEFT,me.input.KEY.ENTER),this.handler=me.event.subscribe(me.event.KEYDOWN,function(e,t,a){"enter"===e&&(me.audio.play("cling"),me.state.change(me.state.PLAY))})},onDestroyEvent:function(){me.input.unbindKey(me.input.KEY.ENTER),me.input.unbindPointer(me.input.pointer.LEFT),me.event.unsubscribe(this.handler)}});